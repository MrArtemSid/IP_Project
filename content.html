<!DOCTYPE HTML>
<html>
  <head>
    <script src="scripts/webadb.js"></script>
    <script>
      let adb;
      let webusb;

      let log = (...args) => {
        if (args[0] instanceof Error) {
          console.error.apply(console, args);
        } else {
          console.log.apply(console, args);
        }
        document.getElementById('log').innerText += args.join(' ') + '\n';
      };

      let init = async () => {
        log('init');
        webusb = await Adb.open("WebUSB");
      };

      let connect = async () => {
        await init();
        log('connect');
        if (webusb.isAdb()) {
          try {
            adb = null;
            adb = await webusb.connectAdb("host::", () => {
              log("Please check the screen of your " + webusb.device.productName + ".");
            });
          } catch(error) {
            log(error);
            adb = null;
          }
        }
      };

      let disconnect = async () => {
        log('disconnect');
        webusb.close();
      };

      let add_ui = () => {
        // Adb.Opt.use_checksum = false;
        Adb.Opt.debug = true;
        // Adb.Opt.dump = true;

        document.getElementById('connect').onclick = connect;
        document.getElementById('disconnect').onclick = disconnect;

        document.getElementById('clear').onclick = () => {
          document.getElementById('log').innerText = '';
        };
      };

      document.addEventListener('DOMContentLoaded', add_ui, false);
    </script>
  </head>
  <body>
    <button id="connect">Connect</button>
    <br />
    <br />

    <button id="disconnect">Disconnect</button>
    <br />
    <br />
    <h2>Messages <button id="clear">clear</button></h2>
    <pre id="log"></pre>
  </body>
</html>
